<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0"/>
    <title>Sucrose Chart</title>
    <link rel="stylesheet" href="sucrose.min.css">
    <style>
        .chart {
            position: absolute;
            top: 0;
            right: 0;
            bottom: 0;
            left: 0;
        }
        .chart svg {
            width: 100%;
            height: 100%;
        }
        .chart text,
        .chart .tooltip {
            font-family: "Helvetica Neue", Arial, sans-serif;
            line-height: 16px;
        }
    </style>
  </head>
  <body>
    <div id="chart_" class="chart">
      <svg></svg>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.17/d3.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/queue-async/1.0.7/queue.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/topojson/1.6.20/topojson.min.js"></script>
    <script src="sucrose.min.js"></script>
    <script>
var KEYMETHODMAP = {
        'show_labels': 'showLabels',
        'show_values': 'showValues',
        'allow_scroll': 'allowScroll',
        'tick_display': 'tickDisplay',
        'color_data': 'colorData',
        'color_options': 'colorOptions',
        'hole_label': 'holeLabel',
        'donut_ratio': 'donutRatio',
        'wrap_labels': 'wrapLabels',
        'mirror_axis': 'mirrorAxis',
        'texture_fill': 'textureFill',
        'show_title': 'showTitle',
        'show_legend': 'showLegend',
        'show_controls': 'showControls',
        'series_click': 'seriesClick',
        'tooltips': 'tooltips'
    };

var Data = {{Data}};
var Config = {{Config}};

window.onload = function () {
    var type = '{{Type}}';
    var yIsCurrency = Data.properties && Data.properties.yDataType === 'currency';
    var k, m;

{{Chart}}

    for (k in Config) {
        if (!Config.hasOwnProperty(k)) {
            continue;
        }

        m = KEYMETHODMAP[k] || k;

        if (!chart[m]) {
            continue;
        }

        switch (m)
        {
            case 'colorData':
                chart
                    .colorData(Config.color_data, Config.color_options);
                break;

            case 'seriesClick':
                chart
                    .seriesClick(function (Data, eo, chart) {
                        chart.dataSeriesActivate(eo);
                    });
                break;

            default:
                chart[m](Config[k]);
        }
    }

    // Bind D3 chart to SVG element
    d3.select('#chart_ svg')
        .attr('class', 'sucrose sc-chart sc-chart-{{Type}}')
        .datum(Data).call(chart);

    // Dismiss tooltips
    d3.select('#chart_').on('click', chart.dispatch.chartClick);

    // Rebind window resizer
    window.addEventListener('resize', chart.render);
};
    </script>
  </body>
</html>
