<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0"/>
    <title>Sucrose Chart</title>
    <link rel="stylesheet" href="sucrose.min.css">
    <style>
        .chart {
            position: absolute;
            top: 0;
            right: 0;
            bottom: 0;
            left: 0;
        }
    </style>
  </head>
  <body>
    <div id="chart_" class="chart">
      <svg></svg>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/4.2.1/d3.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/topojson/1.6.26/topojson.min.js"></script>
    <script src="sucrose.min.js"></script>

    <script>
var type = '{{Type}}';
var data = {{Data}};
var config = {{Config}};
var chart = sucrose.models.{{Model}}();

var yIsCurrency = data.properties && data.properties.yDataType === 'currency';
var xIsDatetime = data.properties && data.properties.xDataType === 'datetime';

function configure(chart) {
    var k, v;

    for (k in config)
    {
        if (!config.hasOwnProperty(k)) {
            continue;
        }

        switch (k)
        {
            case 'colorData':
                if (!chart.colorData) {
                    continue;
                }
                chart.colorData(config.colorData, config.colorOptions);
                break;

            case 'showLabels':
                v = !!parseInt(config[k], 10);
                if (chart.xAxis) {
                    chart.xAxis.axisLabel(v ? 'X-Axis Label' : null);
                }
                if (chart.yAxis) {
                    chart.yAxis.axisLabel(v ? 'Y-Axis Label' : null);
                }
                break;

            case 'tickDisplay':
                v = config[k];
                if (chart.wrapTicks) {
                    chart.wrapTicks(v.indexOf('wrap') !== -1)
                }
                if (chart.staggerTicks) {
                    chart.staggerTicks(v.indexOf('stagger') !== -1)
                }
                if (chart.rotateTicks) {
                    chart.rotateTicks(v.indexOf('rotate') !== -1);
                }
                break;

            default:
                if (!chart[k]) {
                    continue;
                }
                chart[k](config[k]);
        }
    }
}

{{Format}}

window.onload = function () {
    configure(chart);
    format(chart);

    // Bind D3 chart to SVG element
    d3.select('#chart_ svg')
        .attr('class', 'sucrose sc-chart sc-chart-' + type)
        .datum(data).call(chart);

    // Dismiss tooltips
    d3.select('#chart_').on('click', chart.dispatch.chartClick);

    // Rebind window resizer
    window.addEventListener('resize', chart.render);
};
    </script>
  </body>
</html>
