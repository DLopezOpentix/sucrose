<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0"/>
    <title>Sucrose Chart - bubble</title>
    <link rel="stylesheet" href="../build/sucrose.min.css">
    <style>
      .chart {
        position: absolute;
        top: 0;
        right: 0;
        bottom: 0;
        left: 0;
      }
    </style>
  </head>
  <body>
    <div id="chart_" class="chart">
      <svg class="sucrose sc-chart"></svg>
    </div>

<script src="../build/d3.min.js"></script>

<script src="../build/sucrose.js"></script>

<script>
var type = 'bubble';
var data = {
  "data": [
    {
      "id": "3a458f54-264e-e8f4-2eed-516f68ef6295",
      "x": "2013-05-23",
      "y": 71989,
      "shape": "circle",
      "account_name": "Davenport Investing",
      "assigned_user_name": "Sally Bronsen",
      "sales_stage": "Id. Decision Makers",
      "sales_stage_short": "Id. Deciders",
      "probability": 40,
      "base_amount": 71989,
      "currency_symbol": "$"
    },
    {
      "id": "85d9a18a-84e1-59f0-c102-516f6871bce4",
      "x": "2013-04-23",
      "y": 70148,
      "shape": "circle",
      "account_name": "Max Holdings Ltd",
      "assigned_user_name": "Chris Olliver",
      "sales_stage": "Perception Analysis",
      "sales_stage_short": "Percept. Analysis",
      "probability": 50,
      "base_amount": 70148,
      "currency_symbol": "$"
    },
    {
      "id": "c68234e4-4304-2d6b-0d3d-516f682f0dbc",
      "x": "2013-05-26",
      "y": 69667,
      "shape": "circle",
      "account_name": "Coolview Net Ltd",
      "assigned_user_name": "Will Westin",
      "sales_stage": "Qualification",
      "sales_stage_short": "Qualification",
      "probability": 20,
      "base_amount": 69667,
      "currency_symbol": "$"
    },
    {
      "id": "1723a261-9c78-0eec-0d7d-516f68fd5c73",
      "x": "2013-05-19",
      "y": 68761,
      "shape": "circle",
      "account_name": "Super Star Holdings Inc",
      "assigned_user_name": "Sarah Smith",
      "sales_stage": "Needs Analysis",
      "sales_stage_short": "Needs Analysis",
      "probability": 25,
      "base_amount": 68761,
      "currency_symbol": "$"
    },
    {
      "id": "cb2f1f0b-8705-9f12-9dcf-516f68159151",
      "x": "2013-06-21",
      "y": 68675,
      "shape": "circle",
      "account_name": "Airline Maintenance Co",
      "assigned_user_name": "Sally Bronsen",
      "sales_stage": "Perception Analysis",
      "sales_stage_short": "Percept. Analysis",
      "probability": 50,
      "base_amount": 68675,
      "currency_symbol": "$"
    },
    {
      "id": "c0ec30c2-02ea-1cbf-e868-516f686a4577",
      "x": "2013-04-22",
      "y": 68611,
      "shape": "circle",
      "account_name": "TJ O'Rourke Inc",
      "assigned_user_name": "Sally Bronsen",
      "sales_stage": "Qualification",
      "sales_stage_short": "Qualification",
      "probability": 20,
      "base_amount": 68611,
      "currency_symbol": "$"
    },
    {
      "id": "90bed37a-8bf5-e800-fd76-516f68a79e3f",
      "x": "2013-05-29",
      "y": 68597,
      "shape": "circle",
      "account_name": "B.C. Investing International",
      "assigned_user_name": "Will Westin",
      "sales_stage": "Id. Decision Makers",
      "sales_stage_short": "Id. Deciders",
      "probability": 40,
      "base_amount": 68597,
      "currency_symbol": "$"
    },
    {
      "id": "58f2d8f0-32c3-8113-4fa8-516f68c99cc2",
      "x": "2013-04-21",
      "y": 68427,
      "shape": "circle",
      "account_name": "Coolview Net Ltd",
      "assigned_user_name": "Jim Brennan",
      "sales_stage": "Perception Analysis",
      "sales_stage_short": "Percept. Analysis",
      "probability": 50,
      "base_amount": 68427,
      "currency_symbol": "$"
    },
    {
      "id": "19045159-b7e1-7ffe-1622-516f6877c47b",
      "x": "2013-05-23",
      "y": 68384,
      "shape": "circle",
      "account_name": "JJ Resources Inc",
      "assigned_user_name": "Chris Olliver",
      "sales_stage": "Qualification",
      "sales_stage_short": "Qualification",
      "probability": 20,
      "base_amount": 68384,
      "currency_symbol": "$"
    },
    {
      "id": "2072bd6d-73f0-776b-0c84-516f68fcb44f",
      "x": "2013-05-21",
      "y": 67795,
      "shape": "circle",
      "account_name": "Smith & Sons",
      "assigned_user_name": "Will Westin",
      "sales_stage": "Proposal/Price Quote",
      "sales_stage_short": "Proposal/Quote",
      "probability": 65,
      "base_amount": 67795,
      "currency_symbol": "$"
    }
  ],
  "properties": {
    "title": "Bubble Chart Data",
    "yDataType": "string",
    "xDataType": "datetime",
    "colorLength": 10
  }
};
var config = {
  "colorData": [
    "default",
    {}
  ],
  "direction": "ltr",
  "height": null,
  "id": "chart_",
  "locality": {
    "label": "American English",
    "decimal": ".",
    "thousands": ",",
    "grouping": [
      3
    ],
    "currency": [
      "$",
      ""
    ],
    "dateTime": "%B %-d, %Y at %-I:%M:%S %p GMT%Z",
    "date": "%-m/%-d/%Y",
    "time": "%-I:%M %p",
    "periods": [
      "AM",
      "PM"
    ],
    "days": [
      "Sunday",
      "Monday",
      "Tuesday",
      "Wednesday",
      "Thursday",
      "Friday",
      "Saturday"
    ],
    "shortDays": [
      "Sun",
      "Mon",
      "Tue",
      "Wed",
      "Thu",
      "Fri",
      "Sat"
    ],
    "months": [
      "January",
      "February",
      "March",
      "April",
      "May",
      "June",
      "July",
      "August",
      "September",
      "October",
      "November",
      "December"
    ],
    "shortMonths": [
      "Jan",
      "Feb",
      "Mar",
      "Apr",
      "May",
      "Jun",
      "Jul",
      "Aug",
      "Sep",
      "Oct",
      "Nov",
      "Dec"
    ],
    "full": "%A, %B %-d, %Y at %-I:%M:%S %p GMT%Z",
    "long": "%B %-d, %Y at %-I:%M:%S %p GMT%Z",
    "medium": "%b %-d, %Y, %-I:%M:%S %p",
    "short": "%-m/%-d/%y, %-I:%M %p",
    "yMMMEd": "E, %b %-d, %Y",
    "yMEd": "E, %-m/%-d/%Y",
    "yMMMMd": "%b %-d, %Y",
    "yMMMd": "%b %-d, %Y",
    "yMd": "%-m/%-d/%Y",
    "yMMMM": "%B %Y",
    "yMMM": "%b %Y",
    "MMMd": "%b %-d",
    "EEEE": "%A",
    "MMMM": "%B",
    "MMM": "%b",
    "M": "%-m",
    "y": "%Y",
    "d": "%-d",
    "E": "%a"
  },
  "margin": {
    "top": 10,
    "right": 10,
    "bottom": 10,
    "left": 10
  },
  "showTitle": true,
  "showLegend": true,
  "showControls": true,
  "strings": {
    "legend": {
      "close": "Hide legend",
      "open": "Show legend"
    },
    "controls": {
      "close": "Hide controls",
      "open": "Show controls"
    },
    "noData": "No Data Available.",
    "noLabel": "undefined"
  },
  "tooltips": true,
  "width": null,
  "xAxisLabel": "X-Axis Label",
  "yAxisLabel": "Y-Axis Label",
  "wrapTicks": true,
  "staggerTicks": true,
  "rotateTicks": true
};

var chart = sucrose.charts.bubbleChart();

var yIsCurrency = data.properties && data.properties.yDataType === 'currency';
var xIsDatetime = data.properties && data.properties.xDataType === 'datetime';

function configure(type, chart, config) {
  // do not use Object.each because we don't load Sugar
  Object.getOwnPropertyNames(config).forEach(function(k, i, a) {
    var m = chart[k];
    m = sucrose.utility.isFunction(m) && m;
    if (!m) {
      return;
    }
    var v = sucrose.utility.toNative(config[k]);
    if (Array.isArray(v)) {
      m.apply(chart, v);
    } else {
      m(v);
    }
  });
}

function format(chart, callback) {
  chart
    .x(function(d) { return d3.timeParse('%Y-%m-%d')(d.x); })
    .y(function(d) { return d.y; })
    .showControls(false)
    .groupBy(function(d) {
        return d.assigned_user_name;
    })
    .filterBy(function(d) {
      return d.probability;
    })
    .tooltipContent(function(eo, properties) {
      var point = eo.point;
      return '<p>Assigned: <b>' + point.assigned_user_name + '</b></p>' +
             '<p>Amount: <b>' + d3.format(',.2d')(point.opportunity) + '</b></p>' +
             '<p>Close Date: <b>' + d3.timeFormat('%x')(d3.timeParse('%Y-%m-%d')(point.x)) + '</b></p>' +
             '<p>Probability: <b>' + point.probability + '%</b></p>' +
             '<p>Account: <b>' + point.account_name + '</b></p>';
    });
  callback(chart);
}

window.onload = function () {
    // apply configuration
    configure(type, chart, config);

    // format then render chart
    format(chart, function() {
        // Bind D3 chart to SVG element
        d3.select('#chart_ svg')
            .attr('class', 'sucrose sc-chart sc-chart-' + type)
            .datum(data)
                .call(chart);

        // Dismiss tooltips
        d3.select('#chart_')
            .on('click', function() {
                if (chart.dispatch && chart.dispatch.chartClick) {
                    chart.dispatch.chartClick();
                }
            });

        // Rebind window resizer
        window.addEventListener('resize', function() {
            if (chart.render) {
                chart.render();
            } else if (chart.update) {
                chart.update();
            }
        });
    });
};
</script>
  </body>
</html>
 + d3.format(',.2d')(point.opportunity) + '</b></p>' +
             '<p>Close Date: <b>' + d3.timeFormat('%x')(d3.timeParse('%Y-%m-%d')(point.x)) + '</b></p>' +
             '<p>Probability: <b>' + point.probability + '%</b></p>' +
             '<p>Account: <b>' + point.account_name + '</b></p>';
    });
  callback(chart);
}

window.onload = function () {
    // apply configuration
    configure(type, chart, config);

    // format then render chart
    format(chart, function() {
        // Bind D3 chart to SVG element
        d3.select('#chart_ svg')
            .attr('class', 'sucrose sc-chart sc-chart-' + type)
            .datum(data)
                .call(chart);

        // Dismiss tooltips
        d3.select('#chart_')
            .on('click', function() {
                if (chart.dispatch && chart.dispatch.chartClick) {
                    chart.dispatch.chartClick();
                }
            });

        // Rebind window resizer
        window.addEventListener('resize', function() {
            if (chart.render) {
                chart.render();
            } else if (chart.update) {
                chart.update();
            }
        });
    });
};
</script>
  </body>
</html>
