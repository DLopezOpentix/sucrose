<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0"/>
    <title>Sucrose Chart</title>
    <link rel="stylesheet" href="sucrose.min.css">
    <style>
        .chart {
            position: absolute;
            top: 0;
            right: 0;
            bottom: 0;
            left: 0;
        }
    </style>
  </head>
  <body>
    <div id="chart_" class="chart">
      <svg></svg>
    </div>

    <script src="d3.min.js"></script>
    <script src="d3fc-rebind.min.js"></script>

    <script src="src/core.js"></script>
    <script src="src/tooltip.js"></script>
    <script src="src/utils.js"></script>
    <script src="src/models/axis.js"></script>
    <script src="src/models/legend.js"></script>
    <script src="src/models/scatter.js"></script>
    <script src="src/models/bubbleChart.js"></script>

    <script>
var type = 'bubble';
var data = {
  "data": [
    {
      "id": "696b0ae0-12fc-ae49-f494-55c24250d340",
      "x": "2015-09-28",
      "y": 7854,
      "shape": "circle",
      "account_name": "Hammer Group Inc",
      "assigned_user_name": "Jim Brennan",
      "sales_stage": "Id. Decision Makers",
      "sales_stage_short": "Id. Decision Makers",
      "probability": 40,
      "base_amount": "7069.000000",
      "currency_symbol": "€",
      "currency_id": "8dc8d70d-e001-2c19-97f1-55c242e0ae35"
    },
    {
      "id": "500bfe7c-fafc-1736-93f5-55c242078a25",
      "x": "2015-09-07",
      "y": 7000,
      "shape": "circle",
      "account_name": "Union Bank",
      "assigned_user_name": "Jim Brennan",
      "sales_stage": "Prospecting",
      "sales_stage_short": "Prospecting",
      "probability": 10,
      "base_amount": "7000.000000",
      "currency_symbol": "$",
      "currency_id": "-99"
    },
    {
      "id": "8bcd5b97-6a00-ab48-0c7f-55c242f7ae71",
      "x": "2015-08-13",
      "y": 7734,
      "shape": "circle",
      "account_name": "Hammer Group Inc",
      "assigned_user_name": "Jim Brennan",
      "sales_stage": "Qualification",
      "sales_stage_short": "Qualification",
      "probability": 20,
      "base_amount": "6961.000000",
      "currency_symbol": "€",
      "currency_id": "8dc8d70d-e001-2c19-97f1-55c242e0ae35"
    },
    {
      "id": "b68cf9f0-365d-4c80-f6f1-55c242da1faf",
      "x": "2015-10-24",
      "y": 6373,
      "shape": "circle",
      "account_name": "Southern Realty",
      "assigned_user_name": "Jim Brennan",
      "sales_stage": "Proposal/Price Quote",
      "sales_stage_short": "Proposal/Price Quote",
      "probability": 65,
      "base_amount": "6373.000000",
      "currency_symbol": "$",
      "currency_id": "-99"
    },
    {
      "id": "2a931be7-b551-e8b3-7187-55c242b65308",
      "x": "2015-08-17",
      "y": 5918,
      "shape": "circle",
      "account_name": "24/7 Couriers",
      "assigned_user_name": "Jim Brennan",
      "sales_stage": "Prospecting",
      "sales_stage_short": "Prospecting",
      "probability": 10,
      "base_amount": "5918.000000",
      "currency_symbol": "$",
      "currency_id": "-99"
    },
    {
      "id": "8a760861-3fec-5cd5-a4f9-55c2421ed054",
      "x": "2015-10-31",
      "y": 6562,
      "shape": "circle",
      "account_name": "Hammer Group Inc",
      "assigned_user_name": "Jim Brennan",
      "sales_stage": "Id. Decision Makers",
      "sales_stage_short": "Id. Decision Makers",
      "probability": 40,
      "base_amount": "5906.000000",
      "currency_symbol": "€",
      "currency_id": "8dc8d70d-e001-2c19-97f1-55c242e0ae35"
    },
    {
      "id": "d635dc99-cc2e-5610-2b03-55c2429b3621",
      "x": "2015-09-19",
      "y": 5827,
      "shape": "circle",
      "account_name": "Hammer Group Inc",
      "assigned_user_name": "Jim Brennan",
      "sales_stage": "Qualification",
      "sales_stage_short": "Qualification",
      "probability": 20,
      "base_amount": "5827.000000",
      "currency_symbol": "$",
      "currency_id": "-99"
    },
    {
      "id": "8423b185-1774-75af-db04-55c24257dcaa",
      "x": "2015-12-31",
      "y": 10000,
      "shape": "circle",
      "account_name": "Hammer Group Inc",
      "assigned_user_name": "Jim Brennan",
      "sales_stage": "Closed Won",
      "sales_stage_short": "Closed Won",
      "probability": 100,
      "base_amount": "5814.000000",
      "currency_symbol": "$",
      "currency_id": "-99"
    },
    {
      "id": "51b9694e-be33-cf34-b0f9-55c242376809",
      "x": "2015-1-1",
      "y": 10000,
      "shape": "circle",
      "account_name": "Union Bank",
      "assigned_user_name": "Jim Brennan",
      "sales_stage": "Value Proposition",
      "sales_stage_short": "Value Proposition",
      "probability": 30,
      "base_amount": "5332.000000",
      "currency_symbol": "$",
      "currency_id": "-99"
    },
    {
      "id": "545aa631-3009-13d0-c3a6-55c24241db01",
      "x": "2015-02-01",
      "y": 5921,
      "shape": "circle",
      "account_name": "Union Bank",
      "assigned_user_name": "Jim Brennan",
      "sales_stage": "Closed Won",
      "sales_stage_short": "Closed Won",
      "probability": 100,
      "base_amount": "5329.000000",
      "currency_symbol": "€",
      "currency_id": "8dc8d70d-e001-2c19-97f1-55c242e0ae35"
    }
  ],
  "properties": {
    "title": "Top 10 Sales",
    "value": 10,
    "yDataType": "string",
    "xDataType": "datetime"
  }
};
var config = {
  "colorData": "default",
  "direction": "ltr",
  "height": null,
  "id": "chart_",
  "locality": {
    "label": "English (US)",
    "decimal": ".",
    "thousands": ",",
    "grouping": [
      3
    ],
    "currency": [
      "$",
      ""
    ],
    "dateTime": "%B %-d, %Y at %-I:%M:%S %p GMT%Z",
    "date": "%-m/%-d/%Y",
    "time": "%-I:%M %p",
    "periods": [
      "AM",
      "PM"
    ],
    "days": [
      "Sunday",
      "Monday",
      "Tuesday",
      "Wednesday",
      "Thursday",
      "Friday",
      "Saturday"
    ],
    "shortDays": [
      "Sun",
      "Mon",
      "Tue",
      "Wed",
      "Thu",
      "Fri",
      "Sat"
    ],
    "months": [
      "January",
      "February",
      "March",
      "April",
      "May",
      "June",
      "July",
      "August",
      "September",
      "October",
      "November",
      "December"
    ],
    "shortMonths": [
      "Jan",
      "Feb",
      "Mar",
      "Apr",
      "May",
      "Jun",
      "Jul",
      "Aug",
      "Sep",
      "Oct",
      "Nov",
      "Dec"
    ],
    "full": "%A, %B %-d, %Y at %-I:%M:%S %p GMT%Z",
    "long": "%B %-d, %Y at %-I:%M:%S %p GMT%Z",
    "medium": "%b %-d, %Y, %-I:%M:%S %p",
    "short": "%-m/%-d/%y, %-I:%M %p",
    "yMMMEd": "E, %b %-d, %Y",
    "yMEd": "E, %-m/%-d/%Y",
    "yMMMMd": "%b %-d, %Y",
    "yMMMd": "%b %-d, %Y",
    "yMd": "%-m/%-d/%Y",
    "yMMMM": "%B %Y",
    "yMMM": "%b %Y",
    "MMMd": "%b %-d",
    "EEEE": "%A",
    "MMMM": "%B",
    "MMM": "%b",
    "M": "%-m",
    "y": "%Y",
    "d": "%-d",
    "E": "%a"
  },
  "margin": {
    "top": 10,
    "right": 10,
    "bottom": 10,
    "left": 10
  },
  "showTitle": true,
  "showLegend": true,
  "strings": {
    "legend": {
      "close": "Hide legend",
      "open": "Show legend"
    },
    "controls": {
      "close": "Hide controls",
      "open": "Show controls"
    },
    "noData": "No Data Available.",
    "noLabel": "undefined"
  },
  "tooltips": true,
  "width": null,
  "gradient": [
    "0",
    "vertical",
    "middle"
  ],
  "locale": "en",
  "showLabels": "0",
  "mirrorAxis": "lab",
  "tickDisplay": [
    "wrap",
    "stagger",
    "rotate"
  ],
  "wrapLabels": "1",
  "colorOptions": {}
};
var chart = sucrose.models.bubbleChart();

var yIsCurrency = data.properties && data.properties.yDataType === 'currency';
var xIsDatetime = data.properties && data.properties.xDataType === 'datetime';

function configure(chart) {
    var k, v;

    for (k in config)
    {
        if (!config.hasOwnProperty(k)) {
            continue;
        }

        switch (k)
        {
            case 'colorData':
                if (!chart.colorData) {
                    continue;
                }
                chart.colorData(config.colorData, config.colorOptions);
                break;

            case 'showLabels':
                v = !!parseInt(config[k], 10);
                if (chart.xAxis) {
                    chart.xAxis.axisLabel(v ? 'X-Axis Label' : null);
                }
                if (chart.yAxis) {
                    chart.yAxis.axisLabel(v ? 'Y-Axis Label' : null);
                }
                break;

            case 'tickDisplay':
                v = config[k];
                if (chart.wrapTicks) {
                    chart.wrapTicks(v.indexOf('wrap') !== -1)
                }
                if (chart.staggerTicks) {
                    chart.staggerTicks(v.indexOf('stagger') !== -1)
                }
                if (chart.rotateTicks) {
                    chart.rotateTicks(v.indexOf('rotate') !== -1);
                }
                break;

            default:
                if (!chart[k]) {
                    continue;
                }
                v = isNaN(parseInt(config[k], 10)) ? config[k] : parseInt(config[k], 10);
                chart[k](v);
        }
    }
}

function format(chart) {
  chart
    .x(function (d) { return d3.timeParse('%Y-%m-%d')(d.x); })
    .y(function (d) { return d.y; })
    .groupBy(function (d) {
        return d.assigned_user_name;
    })
    .filterBy(function (d) {
      return d.probability;
    })
    .tooltipContent(function (key, x, y, e, graph) {
      return '<p>Assigned: <b>' + e.point.assigned_user_name + '</b></p>' +
             '<p>Amount: <b>' + d3.format(',.2d')(e.point.opportunity) + '</b></p>' +
             '<p>Close Date: <b>' + d3.timeFormat('%x')(d3.timeParse('%Y-%m-%d')(e.point.x)) + '</b></p>' +
             '<p>Probability: <b>' + e.point.probability + '%</b></p>' +
             '<p>Account: <b>' + e.point.account_name + '</b></p>';
    });
}

window.onload = function () {
    configure(chart);
    format(chart);

    // Bind D3 chart to SVG element
    d3.select('#chart_ svg')
        .attr('class', 'sucrose sc-chart')
        .datum(data).call(chart);

    // Dismiss tooltips
    d3.select('#chart_').on('click', chart.dispatch.chartClick);

    // Rebind window resizer
    window.addEventListener('resize', chart.render);
};
    </script>
  </body>
</html>
