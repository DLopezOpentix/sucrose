<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0"/>
    <title>Sucrose Chart - tree</title>
    <link rel="stylesheet" href="../build/sucrose.min.css">
    <style>
        .chart {
            position: absolute;
            top: 24px;
            right: 0;
            bottom: 0;
            left: 0;
        }
    </style>
  </head>
  <body>
    <div class="btn-group">
        <button class="btn toggle-control" rel="tooltip" data-control="orientation" title="Toggle orientation">Toggle orientation</button>
        <button class="btn toggle-control" rel="tooltip" data-control="show-all-nodes" title="Show all nodes">Show all nodes</button>
        <button class="btn toggle-control" rel="tooltip" data-control="zoom-to-fit" title="Zoom to fit">Zoom to fit</button>
    </div>
    <div id="chart_" class="chart">
      <svg class="sucrose sc-chart"></svg>
    </div>

    <script src="../build/d3.min.js"></script>
    <!-- {{TopoJSON}} -->
    <script src="../build/sucrose.min.js"></script>

    <script>
var type = 'tree';
var data = {
  "id": 10000,
  "x0": 0,
  "y0": 0,
  "name": "Jim Brennan",
  "title": "VP Sales",
  "image": "avatar_james.jpg",
  "children": [
    {
      "id": 1,
      "name": "Sarah Smith",
      "title": "Sales Manager West",
      "image": "avatar_nate.jpg",
      "url": "http://www.cnn.com",
      "children": [
        {
          "id": 2,
          "name": "Max Jensen",
          "title": "Senior Sales Rep",
          "image": "",
          "children": [
            {
              "id": 8,
              "name": "Alex Jensen",
              "title": "Field Sales Rep",
              "image": "avatar_uwelcome.jpg",
              "children": [
                {
                  "id": 13,
                  "name": "Dave Smith",
                  "title": "Sales Engineer",
                  "image": "avatar_weyland.png"
                },
                {
                  "id": 16,
                  "name": "Jane Doe",
                  "title": "Sales Engineer",
                  "image": "avatar_weyland.png"
                }
              ]
            },
            {
              "id": 19,
              "name": "Felix Jensen",
              "title": "Field Sales Rep",
              "image": "avatar_uwelcome.jpg"
            }
          ]
        },
        {
          "id": 3,
          "name": "Sally Bronsen",
          "title": "Senior Account Rep",
          "image": "avatar_sabra.jpg",
          "children": [
            {
              "id": 5,
              "name": "Alex Jensen",
              "title": "Field Sales Rep",
              "image": "avatar_mia.jpg",
              "children": [
                {
                  "id": 7,
                  "name": "Dave Smith",
                  "title": "Sales Engineer",
                  "image": "avatar_weyland.png"
                }
              ]
            }
          ]
        },
        {
          "id": 4,
          "name": "Max Jensen",
          "title": "Sales Rep",
          "image": "avatar_sabra.jpg",
          "children": [
            {
              "id": 17,
              "name": "Alex Jensen",
              "title": "Field Sales Rep",
              "image": "avatar_uwelcome.jpg"
            },
            {
              "id": 18,
              "name": "Felix Jensen",
              "title": "Field Sales Rep",
              "image": "avatar_uwelcome.jpg"
            }
          ]
        },
        {
          "id": 9,
          "name": "Sally Bronsen",
          "title": "Senior Account Rep",
          "image": "avatar_sabra.jpg",
          "children": [
            {
              "id": 11,
              "name": "Felix Jensen",
              "title": "Field Sales Rep",
              "image": "avatar_uwelcome.jpg"
            }
          ]
        },
        {
          "id": 14,
          "name": "Max Jensen",
          "title": "Sales Rep",
          "image": "avatar_sabra.jpg"
        },
        {
          "id": 15,
          "name": "Sally Bronsen",
          "title": "Senior Account Rep",
          "image": "avatar_sabra.jpg"
        }
      ]
    },
    {
      "id": 6,
      "name": "Will Westin",
      "title": "Sales Manager East",
      "image": "avatar_nate.jpg",
      "children": [
        {
          "id": 12,
          "name": "Chris Olliver",
          "title": "Senior Account Rep",
          "image": "avatar_sabra.jpg"
        }
      ]
    },
    {
      "id": 10,
      "name": "Jane Ganesh",
      "title": "Sales Manager Asia",
      "image": "avatar_mia.jpg"
    }
  ]
};
var config = {
  "height": null,
  "id": "chart_",
  "margin": {
    "top": 10,
    "right": 10,
    "bottom": 10,
    "left": 10
  },
  "width": null,
  "horizontal": false,
  "duration": 500,
  "colorData": "default",
  "gradient": [
    "0",
    "vertical",
    "middle"
  ],
  "direction": "ltr",
  "locale": "en",
  "showTitle": 1,
  "showLabels": "0",
  "vertical": 1,
  "showValues": "1",
  "allowScroll": 1,
  "tickDisplay": [
    "wrap",
    "stagger",
    "rotate"
  ],
  "mirrorAxis": "lab",
  "holeLabel": "0",
  "donut": "1",
  "donutRatio": "0.4",
  "wrapLabels": "1",
  "show_pointer": "1",
  "controls": "",
  "autoSping": 0,
  "locality": {
    "label": "English (US)",
    "decimal": ".",
    "thousands": ",",
    "grouping": [
      3
    ],
    "currency": [
      "$",
      ""
    ],
    "dateTime": "%B %-d, %Y at %-I:%M:%S %p GMT%Z",
    "date": "%-m/%-d/%Y",
    "time": "%-I:%M %p",
    "periods": [
      "AM",
      "PM"
    ],
    "days": [
      "Sunday",
      "Monday",
      "Tuesday",
      "Wednesday",
      "Thursday",
      "Friday",
      "Saturday"
    ],
    "shortDays": [
      "Sun",
      "Mon",
      "Tue",
      "Wed",
      "Thu",
      "Fri",
      "Sat"
    ],
    "months": [
      "January",
      "February",
      "March",
      "April",
      "May",
      "June",
      "July",
      "August",
      "September",
      "October",
      "November",
      "December"
    ],
    "shortMonths": [
      "Jan",
      "Feb",
      "Mar",
      "Apr",
      "May",
      "Jun",
      "Jul",
      "Aug",
      "Sep",
      "Oct",
      "Nov",
      "Dec"
    ],
    "full": "%A, %B %-d, %Y at %-I:%M:%S %p GMT%Z",
    "long": "%B %-d, %Y at %-I:%M:%S %p GMT%Z",
    "medium": "%b %-d, %Y, %-I:%M:%S %p",
    "short": "%-m/%-d/%y, %-I:%M %p",
    "yMMMEd": "E, %b %-d, %Y",
    "yMEd": "E, %-m/%-d/%Y",
    "yMMMMd": "%b %-d, %Y",
    "yMMMd": "%b %-d, %Y",
    "yMd": "%-m/%-d/%Y",
    "yMMMM": "%B %Y",
    "yMMM": "%b %Y",
    "MMMd": "%b %-d",
    "EEEE": "%A",
    "MMMM": "%B",
    "MMM": "%b",
    "M": "%-m",
    "y": "%Y",
    "d": "%-d",
    "E": "%a"
  },
  "colorOptions": {}
};
var chart = sucrose.charts.treeChart();

var yIsCurrency = data.properties && data.properties.yDataType === 'currency';
var xIsDatetime = data.properties && data.properties.xDataType === 'datetime';

function configure() {
var k, v;
for (k in config)
{
if (!config.hasOwnProperty(k)) {
continue;
}
switch (k)
{
case 'colorData':
if (!chart.colorData) {
continue;
}
chart.colorData(config.colorData, config.colorOptions);
break;
case 'showLabels':
v = !!parseInt(config[k], 10);
if (chart.xAxis) {
chart.xAxis.axisLabel(v ? 'X-Axis Label' : null);
}
if (chart.yAxis) {
chart.yAxis.axisLabel(v ? 'Y-Axis Label' : null);
}
break;
case 'tickDisplay':
v = config[k];
if (chart.wrapTicks) {
chart.wrapTicks(v.indexOf('wrap') !== -1)
}
if (chart.staggerTicks) {
chart.staggerTicks(v.indexOf('stagger') !== -1)
}
if (chart.rotateTicks) {
chart.rotateTicks(v.indexOf('rotate') !== -1);
}
break;
default:
if (!chart[k]) {
continue;
}
v = isNaN(parseInt(config[k], 10)) ? config[k] : parseInt(config[k], 10);
if (chart[k]) {
chart[k](v);
}
}
}
}

function format(callback) {
chart
.nodeSize({'width': 124, 'height': 56})
.nodeRenderer(function(content, d, w, h) {
var nodeData = d.data;
if (!nodeData.image || nodeData.image === '') {
nodeData.image = 'user.svg';
}
var container = d3.select('#chart_ svg');
var node = content.append('g').attr('class', 'sc-org-node');
node.append('rect').attr('class', 'sc-org-bkgd')
.attr('x', 0)
.attr('y', 0)
.attr('rx', 2)
.attr('ry', 2)
.attr('width', w)
.attr('height', h);
node.append('image').attr('class', 'sc-org-avatar')
.attr('xlink:href', 'img/' + nodeData.image)
.attr('width', '32px')
.attr('height', '32px')
.attr('transform', 'translate(3, 3)')
.on('error', function() {
d3.select(this).attr('xlink:href', 'img/user.svg');
});
node.append('text').attr('class', 'sc-org-name')
.attr('data-url', nodeData.url)
.attr('transform', 'translate(38, 11)')
.text(function() {
return sucrose.utility.stringEllipsify(nodeData.name, container, 96);
});
node.append('text').attr('class', 'sc-org-title')
.attr('data-url', nodeData.url)
.attr('transform', 'translate(38, 21)')
.text(function() {
return sucrose.utility.stringEllipsify(nodeData.title, container, 96);
});
return node;
})
.zoomExtents({'min': 0.25, 'max': 4})
.nodeClick(function(d) {
alert(d.data.name + ' clicked!');
})
.nodeCallback(function(nodes) {
var container = d3.select('#chart_ svg');
// nodes is the array of enter nodes
nodes
.on('mouseover', function(d) {
var useId = d3.select(this).attr('href');
container
.select(useId)
.select('.sc-org-name')
.classed('hover', true);
})
.on('mouseout', function(d) {
var useId = d3.select(this).attr('href');
container
.select(useId)
.select('.sc-org-name')
.classed('hover', false);
});
});
callback(chart);
}

window.onload = function () {

    // remap d3v4 to d3

    // apply configuration
    configure();

    // format then render chart
    format(function() {
        // Bind D3 chart to SVG element
        d3.select('#chart_ svg')
            .attr('class', 'sucrose sc-chart sc-chart-' + type)
            .datum(data)
                .call(chart);

        // Dismiss tooltips
        d3.select('#chart_')
            .on('click', function() {
                if (chart.dispatch && chart.dispatch.chartClick) {
                    chart.dispatch.chartClick();
                }
            });

        // Rebind window resizer
        window.addEventListener('resize', function() {
            if (chart.render) {
                chart.render();
            } else if (chart.update) {
                chart.update();
            }
        });

        var toggleChart = function(evt) {
            var button = evt.target;
            //if icon clicked get parent button
            switch (button.dataset.control) {
                case 'orientation':
                    chart.nodeSize({'width': 124, 'height': 56}).orientation();
                    break;

                case 'show-all-nodes':
                    chart.showall();
                    break;

                case 'zoom-to-fit':
                    chart.resetZoom();
                    break;

                default:
            }
        };

        document.querySelectorAll('.toggle-control').forEach(function($el) {
          $el.addEventListener('click', toggleChart);
        });

    });
};
    </script>
  </body>
</html>
